/*
 * movement.c
 *
 *  Created on: Apr 24, 2025
 *      Author: adamhwu, jpyong
 */

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include "main.h"
#include "motors.h"
#include "values.h"

int move_dist(float dist) {
	int targetL = encLmm + dist;
	int targetR = encRmm + dist;
	int direction = (dist > 0) ? 1 : 0;
	SetLMotorDirection(direction);
	SetRMotorDirection(direction);
	TIM2->CCR4 = fabsf(mouseSpeed);
	TIM2->CCR3 = fabsf(mouseSpeed);

	while ((encRmm < targetR) && (encLmm < targetL)) {
		continue;
	}

	TIM2->CCR3 = fabsf(0);
	TIM2->CCR4 = fabsf(0);

	return 0;
}

int find_bias() {
	int num = 0;
	SetLMotorDirection(1);
	SetRMotorDirection(1);
	while (encLmm == 0){
		num = num + 10;
		TIM2->CCR3 = fabsf(num);
		HAL_Delay(500);
	}
	TIM2->CCR4 = fabsf(0);
	return num;
}

void turn180() {
	int targetL = encLmm + 85; //~85 is about the amount of change by which the mouse makes a 180
	int targetR = encRmm - 85;
	while ((encLmm < targetL) && (encRmm > targetR)) {
		SetLMotorDirection(1);
		SetRMotorDirection(0);
		TIM2->CCR4 = fabsf(mouseSpeed);
		TIM2->CCR3 = fabsf(mouseSpeed);
	}
	TIM2->CCR4 = fabsf(0);
	TIM2->CCR3 = fabsf(0);
}

void turnLeft() {
	int targetL = encLmm + 170; // 180/2 lol
	while ((encLmm < targetL)) {
		SetLMotorDirection(1);
		TIM2->CCR4 = fabsf(mouseSpeed);
		TIM2->CCR3 = fabsf(0);
	}
	TIM2->CCR4 = fabsf(0);
}

void turnRight() {
	int targetR = encRmm + 150;
	while ((encRmm < targetR)) {
		SetRMotorDirection(1);
		TIM2->CCR3 = fabsf(mouseSpeed);
		TIM2->CCR4 = fabsf(0);
	}
	TIM2->CCR3 = fabsf(0);
}
